name: Deploy-Blog

on: 
    push:
        branches: 
            - master

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
        # 检出代码
        - uses: actions/checkout@v2
        # node
        - uses: actions/setup-node@v3
          with:
            node-version: 20
        - run: npm i pnpm -g
        - run: pnpm install

        - name: 拉取Notion的文章
          env:
          
            # Notion相关环境变量
            NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
            NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          run: |
            # 对应package.json中的script.sync
            pnpm sync

        - name: 配置Git用户名邮箱
          run: |
            git config --global user.name "SSQLQIANBB"
            git config --global user.email "1215323732@qq.com"

        - name: 提交notion拉取的文章到GitHub仓库
          run: |
            echo `date +"%Y-%m-%d %H:%M:%S"` begin > time.txt
            git add .
            git commit -m "更新文档" -a

        - name: 推送文章到仓库
          uses: ad-m/github-push-action@master
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}

        - name: Build
          run: pnpm docs:build


        - name: Deploy
          uses: peaceiris/actions-gh-pages@v3
          with:
            github_token: ${{ secrets.GITHUB_TOKEN }}
            publish_dir: docs/.vitepress/dist
