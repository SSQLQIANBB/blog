- 全局执行上下文关联全局对象（包含变量、指向函数对象的指针）
- 函数都有自己的函数对象（函数名，函数长度、[[scopes]]的指针（作用域的指针））

    函数创建时，就已经生成了作用域链对象


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/798f6593-941a-407f-a3f2-944d2974b71d/62b9f8d4-7e65-4194-b416-8de4c2e1c7e7/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46622V6YDVA%2F20250726%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250726T141617Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEDUaCXVzLXdlc3QtMiJGMEQCICL8Wh6vYNerwghL1i5vR3sDN%2BwWLfC2tHoszmoHOLO%2BAiBMNbezD2cf66C15AmWjn18cgW%2Bh%2F%2BC%2Fzjec5shNm2%2BTir%2FAwheEAAaDDYzNzQyMzE4MzgwNSIMmdO3%2FagpAkLJ0pntKtwDO9%2FGEJ3ApdvuKIdk4%2BPXWDaUtbB0HgBl8m%2F%2F413Fv6FEfvzVwE9qant113fhTmGsvRANJsaCpZF5i2yhFsig9BVZtBBeW2eLjlcUdpqA0LnBdxu8f5%2BzzdL%2Fh5AMzyWH%2FctRyMBoENlr6jp%2FlQmIb%2BIdbdz9AdiWTM4VMSJ6EHWg131FLF85H3ww6Uzd0apOgJ%2Buwc6ZSHQrSDCTxX%2Brb1M9g%2FItCsTE6A%2BhGWaD11p63t3NSaWkyX41t5II2yyarSmE%2FX4HFnxOVt62YJ79Ilzl%2BMPk536uHvcICwOPOlm%2F%2BPbhwVRvzExsqsQ74mMV5ZEIqMaN2W0wnIYtGnmHOvLgnnn2efagRDu3MRVOIMrHqksXb3xjZeL80D9kx7ShlMPch3SekLmDYQxr1vQJQ6k4HBe%2F3NKYBrrCErvH2epqPh0CPe6Ma5ImWR3IJjCUQQdrQrlmmuRLkfq13n0JOYXBrP6NiuKkwMFcR0jOhNQHoJ4gVTYhY8Hx3vf%2BAbYczSjPw4Dg5OSPLIIZmyn23%2BLAq%2BVcC%2BcTvijR%2FFHg7o0XPUDcJVbF4sPnfga%2FzwNNigf0HxlIEs7Nvvl4fOlx783UdfYZyaAUkg7pd%2FVB3f06RhKtcRT%2BOvhVZJ8w86eTxAY6pgEXJgVv41jHuMjGnIXHDqXEq3hj%2FJrL43Um45bV9V6sniR8%2FuUvhDlfH64YuncOMC%2BBFnwR11507FYDjYZBCFp8godf%2BGxjBy59VefyqI8Kik5eKgO7NEtk%2FR9IGZtQ%2BT31fLct67XY6YHqe8hG9BRTOoZmnHNDs5HtdVbe%2FcdR8d01WbDZIvwnAvr9umVaM66EbYgi1WrN4aEJ4KVZao%2F1mElKxK4J&X-Amz-Signature=af0be11ac77245a6c9f733f8a114eb980180555a743679eba71e8f1181dc0518&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    ![Untitled.png](/notion/images/d80b1251dd9f1ea12ee513a1176ed140.png)


    ![Untitled.png](/notion/images/03b87a787e716b8fc8861ddc790d93f7.png)


每个执行上下文都要关联自己的变量对象

- **作用域链的构建**：在函数执行上下文创建时完成，即函数被调用时构建。
- **作用域链的内容**：取决于函数定义时的词法作用域，即函数能够访问哪些变量和函数在函数定义时已经确定。

作用域链虽然在执行上下文创建时构建，但是函数的作用域链取决于函数的定义位置


### 作用域链的构建和内容

- **作用域链的构建**：
    - 当函数被调用时，JavaScript 引擎会创建一个执行上下文，并初始化作用域链。
    - 作用域链的第一层是当前函数的变量对象，然后是所有父级执行上下文的变量对象，直到全局上下文的变量对象。
- **作用域链的内容**：
    - 作用域链的内容取决于函数定义时的词法作用域。也就是说，函数在定义时就决定了它可以访问哪些变量和函数，这些信息构成了作用域链的内容。

```javascript
var num = 100;
function a() { console.log(num); }  // a 的词法作用域是全局作用域
function print() {
  var num = 200;
  a();  // 调用 a
}
print();  // 调用 print
```


### 函数执行阶段

1. **调用** **`print`** **函数**：
    - 创建 `print` 函数的执行上下文。
    - `print` 函数的变量对象包含 `num`（`200`）。
    - `print` 函数的作用域链包含 `print` 的变量对象和全局变量对象。
    - `this` 绑定。
2. **调用** **`a`** **函数**：
    - 创建 `a` 函数的执行上下文。
    - `a` 函数的变量对象（空对象，因为 `a` 没有局部变量）。
    - `a` 函数的作用域链包含 `a` 的变量对象和全局变量对象。
    - `this` 绑定

```javascript
function foo() {
	const a = 100;
	return inner() {
		a++;
		console.log(a);
	}
}

const f = foo();
```

- **作用域**在函数定义时就已经确定，但它所包含的变量在函数被调用时才被实例化。
- **作用域在函数定义时确定**：函数的词法作用域在函数定义时就确定了。函数的作用域链是基于函数定义时的上下文建立的。
- **作用域链在函数调用时使用**：函数被调用时，执行上下文创建并使用在函数定义时确定的作用域链来解析变量。

创建执行上下文时（即代码执行时），会关联变量对象、绑定this、确定作用域链（函数对象的作用域链对象直接复制给执行上下文中的作用域链对象）；


### 题1:


```javascript
var message = '1';

function foo() {
	console.log(message);
	
	var message = '2';
}

foo();
```


执行栈（栈底→栈顶）：全局执行上下文、foo执行上下文；


**函数执行过程**

- foo函数执行上下文中查找message时，优先从自己关联的AO对象中查找；
- 有message且为undefined;
- 打印undefined;

### 题2


```javascript
var message = 'hello'

function bar() {
	console.log(message)
}

var obj = {
	bar: function() {
		var message = 'world';
		
		bar();
	}
}

obj.bar() // 'hello'
```


作用域链和调用位置无关，与创建位置有关；所以打印全局作用域中的message // hello;

