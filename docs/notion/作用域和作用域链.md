- 全局执行上下文关联全局对象（包含变量、指向函数对象的指针）
- 函数都有自己的函数对象（函数名，函数长度、[[scopes]]的指针（作用域的指针））

    函数创建时，就已经生成了作用域链对象


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/798f6593-941a-407f-a3f2-944d2974b71d/62b9f8d4-7e65-4194-b416-8de4c2e1c7e7/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SZTHVMWX%2F20250724%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250724T152255Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAcaCXVzLXdlc3QtMiJHMEUCIAn05McRTrdtlPEHQNINdZm0gHJiMH0dizm0rHvycwbjAiEAqWB3dUhQ%2BXBi1r4W%2BbcULp95EE56mr5%2B4yS7YNabLXIq%2FwMIMBAAGgw2Mzc0MjMxODM4MDUiDF48POlZ%2FMMCddXgQircA5FGD1cuDE55tuNi9gesKmXrcS3Rex4djoo66h4%2FZyhGAWjvhOazloIoRBy33ZQbhaCyQ3CZy1v4rU%2B38owv4ov%2BT2DzVYoaXKAjhNHJ73RUGwJ7GOE1JRBHJRQ0NP9lcJUEhR%2FQEyTwu6tohu4zyJzEsPHhUdxUMQ4XEUvBE6Yn1AR%2FbWNch2MoIWOc77CEcGz8dZqotJoP8gOs%2BcJ1H5r1trIN2KQiHYe5%2FBBmx2ZZIbNxF5PSV4dCU7PJEz9iGgXY8RPdTqHeApdSTY1McOD941XGJQWKwBLH5LDr7vZNMJA%2FTSOR1hJa%2FH29Tdygk9iK2aDxZ9jxQtRWcZU%2BL3R%2Bc0bNy0lKcHz5P%2B64UQpWvSBZhgNrXfaqKG87OzwYSaqkJGfi%2FmtnaXOxZ7IWfIEE4iqQaSLPUOYSMyvfWYpd5Qb9lich7Hg9emS2VFmIgzo9UPyGTvIOKFlSEsRfoI%2FY2F8k1hJuc5mdMTJqL%2Fg3U9Iohl9wkuMvjICOUa14j2PCKrPjH5dMWMlg3Gf%2FAXw8kXYC1oobwDgHuxVc6YQTdsX%2FYRGasGlMKsdOSztcs1nvzaoJ9xp%2F9tiajC45DaUzE5ENDw%2Bsh5%2Frdit7CT7j3mP%2FMm2D8O1%2BldGhMPeUicQGOqUBf8H%2FIDITbrAd8e4%2B%2BS64R5I%2Fd%2Fhe6P9orekc2xj9wP4gP%2FujmbePjOh5xKQ2tRmhnrJziJQ796lE87141wiDRCf7gY4a0a%2ByNbGsxSXQPnVfvBkiacNLXnzipvV7l7mH%2BkaJTe23YURv9ckhCYJrCSdmZkQjOG5vRr7VXbQtmT2E2xgAb2g0oO1DZfQ51i3pK7w0jl%2Fiwqo9uESuSL4nQkL0C2%2FV&X-Amz-Signature=aa44da1b5bcaead035e6cdefe6361360ac1a269aedbd6c49f6471ee45ac8f040&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/798f6593-941a-407f-a3f2-944d2974b71d/3a9b35d5-8401-4e0c-b1dd-38ba050d00d2/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466SZTHVMWX%2F20250724%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250724T152255Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAcaCXVzLXdlc3QtMiJHMEUCIAn05McRTrdtlPEHQNINdZm0gHJiMH0dizm0rHvycwbjAiEAqWB3dUhQ%2BXBi1r4W%2BbcULp95EE56mr5%2B4yS7YNabLXIq%2FwMIMBAAGgw2Mzc0MjMxODM4MDUiDF48POlZ%2FMMCddXgQircA5FGD1cuDE55tuNi9gesKmXrcS3Rex4djoo66h4%2FZyhGAWjvhOazloIoRBy33ZQbhaCyQ3CZy1v4rU%2B38owv4ov%2BT2DzVYoaXKAjhNHJ73RUGwJ7GOE1JRBHJRQ0NP9lcJUEhR%2FQEyTwu6tohu4zyJzEsPHhUdxUMQ4XEUvBE6Yn1AR%2FbWNch2MoIWOc77CEcGz8dZqotJoP8gOs%2BcJ1H5r1trIN2KQiHYe5%2FBBmx2ZZIbNxF5PSV4dCU7PJEz9iGgXY8RPdTqHeApdSTY1McOD941XGJQWKwBLH5LDr7vZNMJA%2FTSOR1hJa%2FH29Tdygk9iK2aDxZ9jxQtRWcZU%2BL3R%2Bc0bNy0lKcHz5P%2B64UQpWvSBZhgNrXfaqKG87OzwYSaqkJGfi%2FmtnaXOxZ7IWfIEE4iqQaSLPUOYSMyvfWYpd5Qb9lich7Hg9emS2VFmIgzo9UPyGTvIOKFlSEsRfoI%2FY2F8k1hJuc5mdMTJqL%2Fg3U9Iohl9wkuMvjICOUa14j2PCKrPjH5dMWMlg3Gf%2FAXw8kXYC1oobwDgHuxVc6YQTdsX%2FYRGasGlMKsdOSztcs1nvzaoJ9xp%2F9tiajC45DaUzE5ENDw%2Bsh5%2Frdit7CT7j3mP%2FMm2D8O1%2BldGhMPeUicQGOqUBf8H%2FIDITbrAd8e4%2B%2BS64R5I%2Fd%2Fhe6P9orekc2xj9wP4gP%2FujmbePjOh5xKQ2tRmhnrJziJQ796lE87141wiDRCf7gY4a0a%2ByNbGsxSXQPnVfvBkiacNLXnzipvV7l7mH%2BkaJTe23YURv9ckhCYJrCSdmZkQjOG5vRr7VXbQtmT2E2xgAb2g0oO1DZfQ51i3pK7w0jl%2Fiwqo9uESuSL4nQkL0C2%2FV&X-Amz-Signature=c8c327593ff8f1e20bce772986b781e9cecfde194ff7b682829dd020e0dd88f4&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    ![Untitled.png](/notion/images/03b87a787e716b8fc8861ddc790d93f7.png)


每个执行上下文都要关联自己的变量对象

- **作用域链的构建**：在函数执行上下文创建时完成，即函数被调用时构建。
- **作用域链的内容**：取决于函数定义时的词法作用域，即函数能够访问哪些变量和函数在函数定义时已经确定。

作用域链虽然在执行上下文创建时构建，但是函数的作用域链取决于函数的定义位置


### 作用域链的构建和内容

- **作用域链的构建**：
    - 当函数被调用时，JavaScript 引擎会创建一个执行上下文，并初始化作用域链。
    - 作用域链的第一层是当前函数的变量对象，然后是所有父级执行上下文的变量对象，直到全局上下文的变量对象。
- **作用域链的内容**：
    - 作用域链的内容取决于函数定义时的词法作用域。也就是说，函数在定义时就决定了它可以访问哪些变量和函数，这些信息构成了作用域链的内容。

```javascript
var num = 100;
function a() { console.log(num); }  // a 的词法作用域是全局作用域
function print() {
  var num = 200;
  a();  // 调用 a
}
print();  // 调用 print
```


### 函数执行阶段

1. **调用** **`print`** **函数**：
    - 创建 `print` 函数的执行上下文。
    - `print` 函数的变量对象包含 `num`（`200`）。
    - `print` 函数的作用域链包含 `print` 的变量对象和全局变量对象。
    - `this` 绑定。
2. **调用** **`a`** **函数**：
    - 创建 `a` 函数的执行上下文。
    - `a` 函数的变量对象（空对象，因为 `a` 没有局部变量）。
    - `a` 函数的作用域链包含 `a` 的变量对象和全局变量对象。
    - `this` 绑定

```javascript
function foo() {
	const a = 100;
	return inner() {
		a++;
		console.log(a);
	}
}

const f = foo();
```

- **作用域**在函数定义时就已经确定，但它所包含的变量在函数被调用时才被实例化。
- **作用域在函数定义时确定**：函数的词法作用域在函数定义时就确定了。函数的作用域链是基于函数定义时的上下文建立的。
- **作用域链在函数调用时使用**：函数被调用时，执行上下文创建并使用在函数定义时确定的作用域链来解析变量。

创建执行上下文时（即代码执行时），会关联变量对象、绑定this、确定作用域链（函数对象的作用域链对象直接复制给执行上下文中的作用域链对象）；


### 题1:


```javascript
var message = '1';

function foo() {
	console.log(message);
	
	var message = '2';
}

foo();
```


执行栈（栈底→栈顶）：全局执行上下文、foo执行上下文；


**函数执行过程**

- foo函数执行上下文中查找message时，优先从自己关联的AO对象中查找；
- 有message且为undefined;
- 打印undefined;

### 题2


```javascript
var message = 'hello'

function bar() {
	console.log(message)
}

var obj = {
	bar: function() {
		var message = 'world';
		
		bar();
	}
}

obj.bar() // 'hello'
```


作用域链和调用位置无关，与创建位置有关；所以打印全局作用域中的message // hello;

