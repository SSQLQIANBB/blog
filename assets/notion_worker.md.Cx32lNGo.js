import{_ as a,c as i,o as n,a as e}from"./app.CEJXAFAq.js";const l="data:image/png;base64,",p="/blog/assets/2f3ed26c880c6862f759ae9890ac15a1.lV1-7PdJ.png",c=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"notion/worker.md","filePath":"notion/worker.md","lastUpdated":1756667629000}'),t={name:"notion/worker.md"};function r(h,s,k,d,E,o){return n(),i("div",null,s[0]||(s[0]=[e('<h3 id="service-worker" tabindex="-1">Service Worker <a class="header-anchor" href="#service-worker" aria-label="Permalink to &quot;Service Worker&quot;">â€‹</a></h3><blockquote><p>æœ¬è´¨ä¸Šå……å½“ Web åº”ç”¨ç¨‹åºã€æµè§ˆå™¨ä¸ç½‘ç»œï¼ˆå¯ç”¨æ—¶ï¼‰ä¹‹é—´çš„<strong>ä»£ç†æœåŠ¡å™¨</strong>ã€‚è¿™ä¸ª API æ—¨åœ¨åˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œå®ƒä¼š<strong>æ‹¦æˆªç½‘ç»œè¯·æ±‚</strong>å¹¶æ ¹æ®ç½‘ç»œæ˜¯å¦å¯ç”¨æ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€æ›´æ–°æ¥è‡ªæœåŠ¡å™¨çš„çš„èµ„æºã€‚å®ƒè¿˜æä¾›å…¥å£ä»¥æ¨é€é€šçŸ¥å’Œè®¿é—®åå°åŒæ­¥ API</p></blockquote><h3 id="shared-worker" tabindex="-1">Shared Worker <a class="header-anchor" href="#shared-worker" aria-label="Permalink to &quot;Shared Worker&quot;">â€‹</a></h3><blockquote><p><strong><code>SharedWorker</code></strong>Â æ¥å£ä»£è¡¨ä¸€ç§ç‰¹å®šç±»å‹çš„ workerï¼Œå¯ä»¥ä»å‡ ä¸ªæµè§ˆä¸Šä¸‹æ–‡ä¸­_è®¿é—®_ï¼Œä¾‹å¦‚å‡ ä¸ªçª—å£ã€iframe æˆ–å…¶ä»– workerã€‚å®ƒä»¬å®ç°ä¸€ä¸ªä¸åŒäºæ™®é€š worker çš„æ¥å£ï¼Œå…·æœ‰ä¸åŒçš„å…¨å±€ä½œç”¨åŸŸ</p></blockquote><p>å¸¸ç”¨åœºæ™¯ï¼š å¤šä¸ªtabé¡µé€šè®¯, githubå¤štabå…±äº«ç™»å½•ä¿¡æ¯</p><blockquote><p>ğŸ’¡ è°ƒè¯•æ–¹å¼ï¼š chrome://inspect/</p></blockquote><h3 id="boardcasechannel-å¾…" tabindex="-1">boardCaseChannelï¼ˆå¾…ï¼‰ <a class="header-anchor" href="#boardcasechannel-å¾…" aria-label="Permalink to &quot;boardCaseChannelï¼ˆå¾…ï¼‰&quot;">â€‹</a></h3><p><strong>Broadcast Channel API</strong>Â å¯ä»¥å®ç°åŒÂ <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E6%BA%90" target="_blank" rel="noreferrer">æº</a>Â ä¸‹æµè§ˆå™¨ä¸åŒçª—å£ï¼ŒTabé¡µï¼Œframeæˆ–è€… iframe ä¸‹çš„Â <a href="https://developer.mozilla.org/en-US/docs/Glossary/browsing_context" target="_blank" rel="noreferrer">æµè§ˆå™¨ä¸Šä¸‹æ–‡</a>Â (é€šå¸¸æ˜¯åŒä¸€ä¸ªç½‘ç«™ä¸‹ä¸åŒçš„é¡µé¢)ä¹‹é—´çš„ç®€å•é€šè®¯ã€‚</p><blockquote><p>Note:Â æ­¤ç‰¹æ€§åœ¨Â Web WorkerÂ ä¸­å¯ç”¨ã€‚</p></blockquote><p>å¹¿æ’­é¢‘é“ä¼šè¢«å‘½åå’Œç»‘å®šåˆ°æŒ‡å®šçš„æºã€‚</p><p>é€šè¿‡åˆ›å»ºä¸€ä¸ªç›‘å¬æŸä¸ªé¢‘é“ä¸‹çš„Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel" target="_blank" rel="noreferrer"><code>BroadcastChannel</code></a>Â å¯¹è±¡ï¼Œä½ å¯ä»¥æ¥æ”¶å‘é€ç»™è¯¥é¢‘é“çš„æ‰€æœ‰æ¶ˆæ¯ã€‚ä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹æ˜¯ï¼Œä½ ä¸éœ€è¦å†ç»´æŠ¤éœ€è¦é€šä¿¡çš„ iframe æˆ– worker çš„ç´¢å¼•ã€‚å®ƒä»¬å¯ä»¥é€šè¿‡æ„é€ Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel" target="_blank" rel="noreferrer"><code>BroadcastChannel</code></a>Â æ¥ç®€å•åœ°â€œè®¢é˜…â€ç‰¹å®šé¢‘é“ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œå…¨åŒå·¥ï¼ˆåŒå‘ï¼‰é€šä¿¡ã€‚</p><p><img src="'+l+`" alt="601cb56f3ffa7d37b3c2e277.png" loading="lazy"></p><h3 id="ä¾‹å­ğŸŒ°" tabindex="-1">ä¾‹å­ğŸŒ° <a class="header-anchor" href="#ä¾‹å­ğŸŒ°" aria-label="Permalink to &quot;ä¾‹å­ğŸŒ°&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// è¿æ¥åˆ°å¹¿æ’­é¢‘é“</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> BroadcastChannel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;test_channel&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å‘é€ç®€å•æ¶ˆæ¯çš„ç¤ºä¾‹  å‚æ•°å¯ä»¥æ˜¯ä»»æ„å¯¹è±¡</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;This is a test message.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ç®€å•ç¤ºä¾‹ï¼Œç”¨äºå°†äº‹ä»¶æ‰“å°åˆ°æ§åˆ¶å°</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ev</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) { console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ev); }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// æ–­å¼€é¢‘é“è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bc.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">close</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel/BroadcastChannel" target="_blank" rel="noreferrer">BroadcastChannel()</a>Â - æ„å»ºå‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel" target="_blank" rel="noreferrer"><code>BroadcastChannel</code></a>Â å¯¹è±¡ï¼Œå¹¶ä¸å¯¹åº”çš„é¢‘é“ç›¸å…³è”ã€‚</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel/onmessage" target="_blank" rel="noreferrer">BroadcastChannel.onmessage</a>Â - å½“Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel" target="_blank" rel="noreferrer"><code>BroadcastChannel</code></a>Â æ¥æ”¶åˆ°ç±»å‹ä¸ºÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MessageEvent" target="_blank" rel="noreferrer"><code>MessageEvent</code></a>Â çš„Â <code>message</code>Â äº‹ä»¶æ—¶ï¼Œ<code>*BroadcastChannel.onmessage**</code>Â å±æ€§å¯ä»¥æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºè¯¥äº‹ä»¶å¯¹åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºæ¥æ‰§è¡Œã€‚</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel/postMessage" target="_blank" rel="noreferrer">BroadcastChannel.postMessage()</a>Â - å¯ä»¥ä½¿ç”¨Â <strong><code>BroadcastChannel.postMessage()</code></strong>Â å‘é€ä¸€æ¡ä»»æ„Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noreferrer"><code>Object</code></a>Â ç±»å‹çš„æ¶ˆæ¯ï¼Œç»™æ‰€æœ‰åŒ<a href="https://developer.mozilla.org/zh-CN/docs/Glossary/%E6%BA%90" target="_blank" rel="noreferrer">æº</a>ä¸‹ç›‘å¬äº†è¯¥é¢‘é“çš„æ‰€æœ‰<a href="https://developer.mozilla.org/en-US/docs/Glossary/browsing_context" target="_blank" rel="noreferrer">æµè§ˆå™¨ä¸Šä¸‹æ–‡</a>ã€‚æ¶ˆæ¯ä»¥Â <code>message</code>Â äº‹ä»¶çš„å½¢å¼å‘é€ç»™æ¯ä¸€ä¸ªç»‘å®šåˆ°è¯¥é¢‘é“çš„å¹¿æ’­é¢‘é“ã€‚</li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/BroadcastChannel/close" target="_blank" rel="noreferrer">BroadcastChannel.close()</a>Â - é€šè¿‡è°ƒç”¨Â <strong><code>BroadcastChannel.close()</code></strong>Â æ–¹æ³•ï¼Œå¯ä»¥é©¬ä¸Šæ–­å¼€å…¶ä¸å¯¹åº”é¢‘é“çš„å…³è”ï¼Œå¹¶è®©å…¶è¢«åƒåœ¾å›æ”¶ã€‚è¿™æ˜¯å¿…è¦çš„æ­¥éª¤ï¼Œå› ä¸ºæµè§ˆå™¨æ²¡æœ‰å…¶å®ƒæ–¹å¼çŸ¥é“é¢‘é“ä¸å†è¢«éœ€è¦ã€‚</li></ul><h3 id="sharedworker" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SharedWorker" target="_blank" rel="noreferrer">SharedWorker</a> <a class="header-anchor" href="#sharedworker" aria-label="Permalink to &quot;[SharedWorker](https://developer.mozilla.org/zh-CN/docs/Web/API/SharedWorker)&quot;">â€‹</a></h3><p><code>SharedWorker</code>Â æ¥å£ä»£è¡¨ä¸€ç§ç‰¹å®šç±»å‹çš„ workerï¼Œå¯ä»¥ä»å‡ ä¸ªæµè§ˆä¸Šä¸‹æ–‡ä¸­_è®¿é—®_ï¼Œä¾‹å¦‚å‡ ä¸ªçª—å£ã€iframe æˆ–å…¶ä»– workerã€‚SharedWorker è¢«å¤šä¸ªé¡µé¢å®ä¾‹åŒ–æ—¶, æ•°æ®æ˜¯å…±äº«çš„.</p><h3 id="ä¾‹å­ğŸŒ°-1" tabindex="-1">ä¾‹å­ğŸŒ° <a class="header-anchor" href="#ä¾‹å­ğŸŒ°-1" aria-label="Permalink to &quot;ä¾‹å­ğŸŒ°&quot;">â€‹</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// page 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SharedWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;worker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//å¦‚æœworker.jså·²ç»ç”¨ addEventListener ç›‘å¬äº† onmessage äº‹ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ start() æ–¹æ³•æ‰‹åŠ¨å¯åŠ¨ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// myWorker.port.start();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">first.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  myWorker.port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([first.value, second.value]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Message posted to worker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">second.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  myWorker.port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([first.value, second.value]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Message posted to worker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myWorker.port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  result1.textContent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Message received from worker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.lastEventId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// page 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myWorker </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SharedWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;worker.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// å¦‚æœworker.jså·²ç»ç”¨ addEventListener ç›‘å¬äº† onmessage äº‹ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ start() æ–¹æ³•æ‰‹åŠ¨å¯åŠ¨ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// myWorker.port.start();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">squareNumber.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onchange</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  myWorker.port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([squareNumber.value, squareNumber.value]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Message posted to worker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">myWorker.port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  result2.textContent </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.data;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Message received from worker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// worker.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onconnect</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> port </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.ports[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> workerResult </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Result: &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> e.data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    port.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(workerResult);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// onconnect = function(e) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  var port = e.ports[0];</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//  port.addEventListener(&#39;message&#39;, function(e) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//    var workerResult = &#39;Result: &#39; + (e.data[0] * e.data[1]);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//    port.postMessage(workerResult);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   });</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//   port.start();</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Required when using addEventListener. Otherwise called implicitly by onmessage setter.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="web-storage-api" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API" target="_blank" rel="noreferrer">Web Storage API</a> <a class="header-anchor" href="#web-storage-api" aria-label="Permalink to &quot;[Web Storage API](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API)&quot;">â€‹</a></h3><p>Web Storage API æä¾›äº†å­˜å‚¨æœºåˆ¶ï¼Œé€šè¿‡è¯¥æœºåˆ¶ï¼Œæµè§ˆå™¨å¯ä»¥å®‰å…¨åœ°å­˜å‚¨é”®å€¼å¯¹.</p><p>Web Storage åŒ…å«å¦‚ä¸‹ä¸¤ç§æœºåˆ¶ï¼š</p><ul><li><code>sessionStorage</code>Â ä¸ºæ¯ä¸€ä¸ªç»™å®šçš„æºï¼ˆgiven originï¼‰ç»´æŒä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨åŒºåŸŸï¼Œè¯¥å­˜å‚¨åŒºåŸŸåœ¨é¡µé¢ä¼šè¯æœŸé—´å¯ç”¨ï¼ˆå³åªè¦æµè§ˆå™¨å¤„äºæ‰“å¼€çŠ¶æ€ï¼ŒåŒ…æ‹¬é¡µé¢é‡æ–°åŠ è½½å’Œæ¢å¤ï¼‰ã€‚</li><li><code>localStorage</code>Â åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨å…³é—­ï¼Œç„¶åé‡æ–°æ‰“å¼€åæ•°æ®ä»ç„¶å­˜åœ¨ã€‚</li></ul><p>è¿™ä¸¤ç§æœºåˆ¶æ˜¯é€šè¿‡Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage" target="_blank" rel="noreferrer"><code>Window.sessionStorage</code></a>Â å’ŒÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage" target="_blank" rel="noreferrer"><code>Window.localStorage</code></a>Â å±æ€§ä½¿ç”¨ï¼ˆæ›´ç¡®åˆ‡çš„è¯´ï¼Œåœ¨æ”¯æŒçš„æµè§ˆå™¨ä¸­Â <code>Window</code>Â å¯¹è±¡å®ç°äº†Â <code>WindowLocalStorage</code>Â å’ŒÂ <code>WindowSessionStorage</code>Â å¯¹è±¡å¹¶æŒ‚åœ¨å…¶Â <code>localStorage</code>Â å’ŒÂ <code>sessionStorage</code>Â å±æ€§ä¸‹ï¼‰â€”â€” è°ƒç”¨å…¶ä¸­ä»»ä¸€å¯¹è±¡ä¼šåˆ›å»ºÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage" target="_blank" rel="noreferrer"><code>Storage</code></a>Â å¯¹è±¡ï¼Œé€šè¿‡Â <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage" target="_blank" rel="noreferrer"><code>Storage</code></a>Â å¯¹è±¡ï¼Œå¯ä»¥è®¾ç½®ã€è·å–å’Œç§»é™¤æ•°æ®é¡¹ã€‚å¯¹äºæ¯ä¸ªæºï¼ˆoriginï¼‰<code>sessionStorage</code>Â å’ŒÂ <code>localStorage</code>Â ä½¿ç”¨ä¸åŒçš„ Storage å¯¹è±¡â€”â€”ç‹¬ç«‹è¿è¡Œå’Œæ§åˆ¶ã€‚</p><p>é€šè¿‡ Web Storageä¸­çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#%E9%80%9A%E8%BF%87_storageevent_%E5%93%8D%E5%BA%94%E5%AD%98%E5%82%A8%E7%9A%84%E5%8F%98%E5%8C%96" target="_blank" rel="noreferrer">é€šè¿‡ StorageEvent å“åº”å­˜å‚¨çš„å˜åŒ–</a>Â ï¼Œå¯ä»¥åšåˆ°åŒæºä¸‹çš„è·¨é¡µé¢çš„æ•°æ®åŒæ­¥ã€‚</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addEventListener</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;storage&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">e</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (e.key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ctc-msg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {        </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parse</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(e.newValue);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> text</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;[receive] &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.msg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39; â€”â€” tab &#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.from;        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;[Storage I] receive message:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, text);    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mydata.st </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Date);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">window.localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ctc-msg&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(mydata));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ— è®ºä½•æ—¶ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage" target="_blank" rel="noreferrer"><code>Storage</code></a>Â å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆå³åˆ›å»º/æ›´æ–°/åˆ é™¤æ•°æ®é¡¹æ—¶ï¼Œ<strong>é‡å¤è®¾ç½®ç›¸åŒçš„é”®å€¼ä¸ä¼šè§¦å‘è¯¥äº‹ä»¶</strong>ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Storage/clear" target="_blank" rel="noreferrer"><code>Storage.clear()</code></a>Â æ–¹æ³•è‡³å¤šè§¦å‘ä¸€æ¬¡è¯¥äº‹ä»¶ï¼‰ï¼Œ<code>StorageEvent</code>Â äº‹ä»¶ä¼šè§¦å‘ã€‚<strong>åœ¨åŒä¸€ä¸ªé¡µé¢å†…å‘ç”Ÿçš„æ”¹å˜ä¸ä¼šèµ·ä½œç”¨â€”â€”åœ¨ç›¸åŒåŸŸåä¸‹çš„å…¶ä»–é¡µé¢ï¼ˆå¦‚ä¸€ä¸ªæ–°æ ‡ç­¾æˆ– iframeï¼‰å‘ç”Ÿçš„æ”¹å˜æ‰ä¼šèµ·ä½œç”¨</strong>ã€‚åœ¨å…¶ä»–åŸŸåä¸‹çš„é¡µé¢ä¸èƒ½è®¿é—®ç›¸åŒçš„ Storage å¯¹è±¡ã€‚</p><h2 id="è·¨æºé€šè®¯" tabindex="-1">è·¨æºé€šè®¯ <a class="header-anchor" href="#è·¨æºé€šè®¯" aria-label="Permalink to &quot;è·¨æºé€šè®¯&quot;">â€‹</a></h2><h3 id="postmessage" tabindex="-1"><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noreferrer">postMessage</a> <a class="header-anchor" href="#postmessage" aria-label="Permalink to &quot;[postMessage](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage)&quot;">â€‹</a></h3><p><code>window.postMessage()</code>Â æ–¹æ³•å¯ä»¥å®‰å…¨åœ°å®ç°è·¨æºé€šä¿¡ã€‚å¯¹äºä¸¤ä¸ªä¸åŒé¡µé¢çš„è„šæœ¬,ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦æ»¡è¶³åŒæºç­–ç•¥æ‰èƒ½è¿›è¡Œæ•°æ®é€šè®¯ã€‚ä½†<code>window.postMessage()</code>æ–¹æ³•æä¾›äº†ä¸€ç§å—æ§æœºåˆ¶æ¥è§„é¿æ­¤é™åˆ¶ï¼Œåªè¦æ­£ç¡®çš„ä½¿ç”¨ï¼Œè¿™ç§æ–¹æ³•å°±å¾ˆå®‰å…¨ã€‚</p><p>ä»å¹¿ä¹‰ä¸Šè®²ï¼Œä¸€ä¸ªçª—å£å¯ä»¥è·å¾—å¯¹å¦ä¸€ä¸ªçª—å£çš„å¼•ç”¨ï¼ˆæ¯”å¦‚Â <code>targetWindow = window.opener</code>ï¼‰ï¼Œç„¶ååœ¨çª—å£ä¸Šè°ƒç”¨Â <code>targetWindow.postMessage()</code>Â æ–¹æ³•åˆ†å‘ä¸€ä¸ªÂ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MessageEvent" target="_blank" rel="noreferrer"><code>MessageEvent</code></a>Â æ¶ˆæ¯ã€‚æ¥æ”¶æ¶ˆæ¯çš„çª—å£å¯ä»¥æ ¹æ®éœ€è¦è‡ªç”±<a href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/Events" target="_blank" rel="noreferrer">å¤„ç†æ­¤äº‹ä»¶</a>ã€‚ä¼ é€’ç»™ window.postMessage() çš„å‚æ•°ï¼ˆæ¯”å¦‚ message ï¼‰å°†<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage#The_dispatched_event" target="_blank" rel="noreferrer">é€šè¿‡æ¶ˆæ¯äº‹ä»¶å¯¹è±¡æš´éœ²ç»™æ¥æ”¶æ¶ˆæ¯çš„çª—å£</a>ã€‚</p><ul><li>otherWindow - å…¶ä»–çª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚iframeçš„contentWindowå±æ€§ã€æ‰§è¡Œ<a href="https://developer.mozilla.org/en-US/docs/DOM/window.open" target="_blank" rel="noreferrer">window.open</a>è¿”å›çš„çª—å£å¯¹è±¡ã€æˆ–è€…æ˜¯å‘½åè¿‡æˆ–æ•°å€¼ç´¢å¼•çš„<a href="https://developer.mozilla.org/en-US/docs/DOM/window.frames" target="_blank" rel="noreferrer">window.frames</a>ã€‚</li><li>message - å°†è¦å‘é€åˆ°å…¶ä»– windowçš„æ•°æ®ã€‚å®ƒå°†ä¼šè¢«<a href="https://developer.mozilla.org/en-US/docs/DOM/The_structured_clone_algorithm" target="_blank" rel="noreferrer">ç»“æ„åŒ–å…‹éš†ç®—æ³•</a>åºåˆ—åŒ–ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¸å—ä»€ä¹ˆé™åˆ¶çš„å°†æ•°æ®å¯¹è±¡å®‰å…¨çš„ä¼ é€ç»™ç›®æ ‡çª—å£è€Œæ— éœ€è‡ªå·±åºåˆ—åŒ–ã€‚[<a href="https://developer.mozilla.org/en-US/docs/" target="_blank" rel="noreferrer">1</a>]</li><li>targetOrigin - é€šè¿‡çª—å£çš„originå±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶ï¼Œå…¶å€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²â€<em>â€œï¼ˆè¡¨ç¤ºæ— é™åˆ¶ï¼‰æˆ–è€…ä¸€ä¸ªURIã€‚åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¦‚æœç›®æ ‡çª—å£çš„åè®®ã€ä¸»æœºåœ°å€æˆ–ç«¯å£è¿™ä¸‰è€…çš„ä»»æ„ä¸€é¡¹ä¸åŒ¹é…targetOriginæä¾›çš„å€¼ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸ä¼šè¢«å‘é€ï¼›åªæœ‰ä¸‰è€…å®Œå…¨åŒ¹é…ï¼Œæ¶ˆæ¯æ‰ä¼šè¢«å‘é€ã€‚è¿™ä¸ªæœºåˆ¶ç”¨æ¥æ§åˆ¶æ¶ˆæ¯å¯ä»¥å‘é€åˆ°å“ªäº›çª—å£ï¼›ä¾‹å¦‚ï¼Œå½“ç”¨postMessageä¼ é€å¯†ç æ—¶ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œå¿…é¡»ä¿è¯å®ƒçš„å€¼ä¸è¿™æ¡åŒ…å«å¯†ç çš„ä¿¡æ¯çš„é¢„æœŸæ¥å—è€…çš„originå±æ€§å®Œå…¨ä¸€è‡´ï¼Œæ¥é˜²æ­¢å¯†ç è¢«æ¶æ„çš„ç¬¬ä¸‰æ–¹æˆªè·ã€‚<em>å¦‚æœä½ æ˜ç¡®çš„çŸ¥é“æ¶ˆæ¯åº”è¯¥å‘é€åˆ°å“ªä¸ªçª—å£ï¼Œé‚£ä¹ˆè¯·å§‹ç»ˆæä¾›ä¸€ä¸ªæœ‰ç¡®åˆ‡å€¼çš„targetOriginï¼Œè€Œä¸æ˜¯</em>ã€‚ä¸æä¾›ç¡®åˆ‡çš„ç›®æ ‡å°†å¯¼è‡´æ•°æ®æ³„éœ²åˆ°ä»»ä½•å¯¹æ•°æ®æ„Ÿå…´è¶£çš„æ¶æ„ç«™ç‚¹ã€‚</em></li></ul><h2 id="åŠ¨æ€åˆ›å»ºworker" tabindex="-1"><strong>åŠ¨æ€åˆ›å»ºworker</strong> <a class="header-anchor" href="#åŠ¨æ€åˆ›å»ºworker" aria-label="Permalink to &quot;**åŠ¨æ€åˆ›å»ºworker**&quot;">â€‹</a></h2><p><img src="`+p+`" alt="image.png" loading="lazy"></p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> dynamicWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> work</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">		onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jobId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;worker-message:&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, message);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">			setTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">				postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({jobId, result: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message from worker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			}, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		};</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pendingJobs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateWorker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">f</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> blob</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Blob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`(\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toString</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">()</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">})()\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> url</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> URL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createObjectURL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(blob);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> worker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onmessage</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">data</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jobId</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			pendingJobs[jobId](result);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			delete</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pendingJobs[jobId]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">		return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">			new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">				const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> jobId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Math.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">random</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				pendingJobs[jobId] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resolve;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				worker.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">postMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ jobId, message });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">			});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> testWorker</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> generateWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (work);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	testWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;message from main thread&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">message</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;i am main thread, i receive:-----&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> message);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	});</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dynamicWorker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div>`,35)]))}const b=a(t,[["render",r]]);export{c as __pageData,b as default};
